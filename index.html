<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Try-catch by JesseZhao1990</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Try-catch</h1>
      <h2 class="project-tagline">总结js中的try catch</h2>
      <a href="https://github.com/JesseZhao1990/try-catch" class="btn">View on GitHub</a>
      <a href="https://github.com/JesseZhao1990/try-catch/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/JesseZhao1990/try-catch/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="总结js中的try-catch" class="anchor" href="#%E6%80%BB%E7%BB%93js%E4%B8%AD%E7%9A%84try-catch" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>总结js中的try catch</h1>

<p>try...catch 可以测试代码中的错误。try 部分包含需要运行的代码，而 catch 部分包含错误发生时运行的代码。</p>

<p>语法：</p>

<pre><code>try
{
    //要运行的代码
}
catch(err)
{
    //出现错误时要允许的代码
}
</code></pre>

<p><strong>大多数情况下，try catch适用于三种场合：</strong></p>

<p>1、浏览器原罪的场合：也就是兼容性场合，由于不同浏览器的报错提示是不一样的，根据捕获的浏览器的报错提示判断用户的浏览器，然后做出对应的措施。</p>

<p>2、中间有繁琐的判断的。比如说筛选面板。初始化的时候有太多的下拉框选项需要从后台加载，可能我没必要每一个下拉框都进行错误处理，因为我只关注所有的查询选项都加载成功，我才能发起查询的请求。只要有一个下拉框选项没加载成功，我就把错误抛给用户，不再发起查询的请求。再比如window.a.b.c.d 我要判断d等于不等于5。那如果window.a根本不存在，我根本没法判断d。所以，我要用n个if判断a b c 分别存在。再判断d。这还不如直接一个try catch呢。只要中间出错。我就直接执行catch。</p>

<p>使用try catch</p>

<pre><code>try
{
    window.a.b.c.d !== 5;
}
catch(err)
{
    console.log("hello world!")
}

</code></pre>

<p>不使用try catch</p>

<pre><code>if(window.a){
    if(window.a.b){
        if(window.a.b.c){
            if(window.a.b.c.d!==5){
                console.log("hellow world!")
            }
        }
    }
}

</code></pre>

<p>有没有崩溃的感觉。即使用&amp;&amp;来简化一下，也需要写成这样的</p>

<pre><code>if(window.a &amp;&amp; window.a.b &amp;&amp; window.a.b.c &amp;&amp; window.a.b.c.d !==5){
    console.log("hello world!");
}

</code></pre>

<p>3、用在nodejs中异常的处理。比如写爬虫。如果半夜三更，你的爬虫遇到了复杂网页的未知错误。如果没用try catch。你的线程就崩溃。程序就停止了。但是如果有了try catch。遇到错误就放弃处理这个网页。转向爬去其他页面。</p>

<p><strong>try catch 中的坑</strong></p>

<p>try catch只能捕获当次事件循环内的异常，对call back执行时抛出的异常将无能为力</p>

<pre><code>function jsonp(setting){
  setting.data = setting.data || {}
  setting.key = setting.key||'callback'
  setting.callback = setting.callback||function(){} 
  setting.data[setting.key] = '__onGetData__'

  window.__onGetData__ = function(data){
    setting.callback (data);
  }

  var script = document.createElement('script')
  var query = []
  for(var key in setting.data){
    query.push( key + '='+ encodeURIComponent(setting.data[key]) )
  }
  script.src = setting.url + '?' + query.join('&amp;')
  document.head.appendChild(script)
  document.head.removeChild(script)

}

try
{
  jsonp({
  url: 'http://photo.sina.cn/aj/index',
  key: 'jsoncallback',
  data: {
    page: 1,
    cate: 'recommend'
  },
  callback: function(ret){
    console.hhhhhhh(ret);   // 这是一句错误的语句。但是并没有被catch到。
  }
  })
  console.log("jsonp已经执行");
}catch(err)
{
  console.log(err);
}

</code></pre>

<p>上边这个例子中，首先定义了一个函数jsonp。这个函数有回调函数。在我运行jsonp的时候.我向jsonp中传送的回调函数有故意写错的地方。但是在控制台里并没有把这个错误打印出来。说明回调函数运行时的错误try catch无法捕捉到。<a href="http://codepen.io/zhaojianxin/pen/xEzBwk?editors=0011">演示地址</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/JesseZhao1990/try-catch">Try-catch</a> is maintained by <a href="https://github.com/JesseZhao1990">JesseZhao1990</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
